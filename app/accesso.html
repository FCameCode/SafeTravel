<!DOCTYPE html>
<html>
    <header>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Home</title>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    </header>
    <body>
        <button id="test">test</button>
        <button id="test2">test2</button>
        <a href="https://localhost:3000/auth_req">
            <button  type="button">
                <p>Accedi con Youtube&nbsp</p>
                <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fleejuan.com%2Fwp-content%2Fuploads%2F2020%2F05%2Fpng-transparent-youtube-logo-youtube-red-logo-sunny-leone-angle-rectangle-brand.png&f=1&nofb=1" width="30px" height="30px">
            </button>
        </a>
        <div></div>

        <script>
            const params = new URLSearchParams(document.location.search);
            const code = params.get("code");
            const my_url = "http://localhost:3000/accesso";

            $("#test2").click(function() {
			    var httpRequest = new XMLHttpRequest();
			    httpRequest.onreadystatechange = function(e) {
                    if (e.target.readyState == XMLHttpRequest.DONE){
                        videos = JSON.parse(e.target.responseText).items;
                        for(let i = 0; i < videos.length; i++) {
                            $("div").append(`
                                <iframe src="https://www.youtube-nocookie.com/embed/${videos[i].id}" frameborder="0" allow="accelerometer; encrypted-media; gyroscope" allowfullscreen></iframe>
                            `);
                        }

                    }
                }
		    	httpRequest.open("GET",`https://localhost:3000/liked_videos`,true);
	    		httpRequest.send();
            });

            $("#test").click(caricaUtente);


            function caricaUtente(e) {
			    var httpRequest = new XMLHttpRequest();
			    httpRequest.onreadystatechange = utente;
		    	httpRequest.open("GET",`https://localhost:3000/test?req_url=${my_url}`,true);
	    		httpRequest.send();
    		}
            function utente(e) {
                if (e.target.readyState == XMLHttpRequest.DONE){
                    //window.location = e.target.responseText;
                    $("p").append(e.target.responseText);
                }
            }
        </script>    
    </body>
</html>